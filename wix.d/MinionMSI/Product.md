
## Product attributes

### UpgradeCode
GUID defining the product across versions. E.g. a previous version is uninstalled during upgrade.
In other words:
For update (or upgrade), Windows Installer relies on the UpgradeCode attribute of the Product tag.
Keep the same UpgradeCode GUID as long as you want the products to be upgraded by the installer.

### Id
[wixtoolset](https://wixtoolset.org/documentation/manual/v3/xsd/wix/product.html): The product code GUID for the product. Type: AutogenGuid

[MS](https://docs.microsoft.com/en-us/windows/win32/msi/product-codes): The product code is a GUID that is the principal identification of an application or product.

[MS](https://docs.microsoft.com/en-us/windows/win32/msi/productcode): This ID must vary for different versions and languages.

[MS](https://docs.microsoft.com/en-us/windows/win32/msi/changing-the-product-code): The product code must be changed if any of the following are true for the update:
- The name of the .msi file has been changed.

[MS](https://docs.microsoft.com/en-us/windows/win32/msi/major-upgrades):
A major upgrade is a comprehensive update of a product that needs a change of the ProductCode Property.
A typical major upgrade removes a previous version of an application and installs a new version.

A constant Product code GUID is (only) useful for a subsequent mst (transform).
To be safe for a major upgrade, the Id (product code GUI) is dynamic/autogenerated: * (star)

Therefore: we use dynamic/autogenerated: * (star)


## Conditionally block installation

[doc](https://wixtoolset.org/documentation/manual/v3/xsd/wix/condition.html)

The logic condition is specified in the inner text of the element.

Quotes from    https://www.firegiant.com/wix/tutorial/com-expression-syntax-miscellanea/expression-syntax
    >> left ends with right
    Properties in expressions:
        PROPERTY     This will evaluate to true if the property has been set and has any value, even if this value is false or 0.
        NOT PROPERTY This will evaluate to true if the property has not been set at all.

On the XML CDATA Section
Quotes from https://www.firegiant.com/wix/tutorial/com-expression-syntax-miscellanea/expression-syntax
    you have to be cautious when you use angle brackets that can be mistaken for an opening or closing character of an XML tag
    The safest approach would be to wrap everything

I found that I must use the CDATA section even around simple properties, but no >=

Properties:

- MsiNTProductType:  1=Workstation  2=Domain controller  3=Server
- VersionNT:
  - Windows  7=601   https://msdn.microsoft.com/library/aa370556.aspx
  - Windows 10=603   https://support.microsoft.com/en-us/help/3202260/versionnt-value-for-windows-10-and-windows-server-2016
- PhysicalMemory     https://docs.microsoft.com/en-us/windows/desktop/Msi/physicalmemory

From the how-to http://wixtoolset.org/documentation/manual/v3/howtos/redistributables_and_install_checks/block_install_on_os.html

## Properties

      Set default values for Salt msi properties
        Naming conventions:   https://docs.microsoft.com/en-us/windows/win32/msi/restrictions-on-property-names
        Public properties may be changed by the user and must be upper-case.

        On msi properties, logic expressions and checkboxes:
          A msi property is false if and only if it is unset, undefined, missing, the empty string (msi properties are strings).
          A checkbox is empty if and only if the relevant msi property is false.

        These are the msi properties unset by default:
           MASTER
           MASTER_KEY
           MINION_ID
           MINION_ID_FUNCTION
           MINION_ID_REMOVE_DOMAIN
           MINION_CONFIG
           ZMQ_FILTERING

        On msi properties, use in custom actions:
          DECAC means "Deferred cusmtom action in C#"
          CADH  means "Custom action data helper"
          You *must* mention each msi property at the CADH helper or the DECAC function will crash:
          (A DECAC that tries to use a msi property not listed in its CADH crashes).
            Example:
              In the CADH:
                master=[MASTER];minion_id_function=[MINION_ID_FUNCTION]
              In the DECAC:
                session.CustomActionData["master"]      THIS IS OK
                session.CustomActionData["mister"]      THIS WILL CRASH
    

        <!-- 
    Windows Installer msi properties              https://docs.microsoft.com/en-us/windows/win32/msi/property-reference
    
    Logging into %TEMP%\MSIxxxxx.LOG  
    All MsiLogging values 
      I Status messages.
      w Nonfatal warnings.
      e All error messages.
      a Start up of actions.
      r Action-specific records.
      u User requests.
      c Initial UI parameters.
      m Out-of-memory or fatal exit information.
      o Out-of-disk-space messages.
      p Terminal properties.
      x Extra debugging information. Only available on Windows Server 2003.
      ! Flush each line to the log.    
      v Verbose output.
    
    -->

    
    <!-- WiX msi properties
      WIXUI_INSTALLDIR
        From https://wixtoolset.org//documentation/manual/v3/wixui/dialog_reference/wixui_installdir.html
          Selecting a user interface
       http://www.dizzymonkeydesign.com/blog/misc/adding-and-customizing-dlgs-in-wix-3/
     -->


## Sequences
      An msi is no linear program.
      To understand when custom actions will be executed, one must look at the condition within the tag and Before/After:

      On custom action conditions:
         http://resources.flexerasoftware.com/web/pdf/archive/IS-CHS-Common-MSI-Conditions.pdf
         https://docs.microsoft.com/en-us/windows/win32/msi/property-reference
       On the upgrade custom action condition:
         UPGRADINGPRODUCTCODE | does not work
         Installed            | the product is installed per-machine or for the current user
         Not Installed        | there is no previous version with the same UpgradeCode
         REMOVE ~= "ALL"      | Uninstall 

      From "Standard actions" https://docs.microsoft.com/en-us/windows/win32/msi/standard-actions-reference
          RemoveFiles            https://docs.microsoft.com/en-us/windows/win32/msi/removefiles-action
          RemoveExistingProducts https://docs.microsoft.com/en-us/windows/win32/msi/removeexistingproducts-action  DISKUSSION WHEN IS HERE
          MigrateFeatureStates
          InstallInitialize

      You get error LGHT0204 when  After or Before are wrong. Example:
        del_NSIS_DECAC is a in-script custom action.  It must be sequenced between InstallInitialize and InstallFinalize in the InstallExecuteSequence

        Notes on ReadConfig_IMCAC:
          Note 1:
            Problem: INSTALLFOLDER was not set in ReadConfig_IMCAC
            Solution:
            ReadConfig_IMCAC must not be called BEFORE FindRelatedProducts, but BEFORE MigrateFeatureStates because
            INSTALLFOLDER in only set in CostFinalize, which comes after FindRelatedProducts
            Maybe one could call ReadConfig_IMCAC AFTER FindRelatedProducts
          Note 2:
            ReadConfig_IMCAC is in both InstallUISequence and InstallExecuteSequence,
            but because it is declared Execute='firstSequence', it will not be repeated in InstallExecuteSequence if it has been called in InstallUISequence.
      -->